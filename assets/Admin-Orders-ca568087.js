import{D as k}from"./DialogModal-29e49acd.js";import{t as m}from"./index-0526d3af.js";import{b6 as g,av as y,aj as i,l as d,t as x,b1 as _,au as D,m as t,aJ as a,F as w,at as v,s as h,b3 as O,k as C}from"./_plugin-vue_export-helper-01f09012.js";import{m as $,b as M,o as b}from"./vueLoadingStore-c0b7b794.js";import{l as T,w as B}from"./runtime-dom.esm-bundler-21d14b8b.js";const P={props:{orderData:{type:Object,required:!0}},methods:{toThousand:m,productDiscount(s){const{scale:o,type:n,code:r}=this.orderData.discount;return s.isDiscount&&r?n==="money"?m(s.totalPrice-o):m(Math.round(s.totalPrice*o)):""},totalDiscountPrice(s){const o=s.cart.reduce((n,r)=>{if(r.isDiscount){const{scale:u,type:l}=this.orderData.discount;l==="money"?n+=r.totalPrice-u:n+=Math.round(r.totalPrice*u)}else n+=r.totalPrice;return n},0);return m(o)}},components:{DialogModal:k}},I=t("p",{class:"text-xl font-black font-self text-brand-02"},"訂單詳情",-1),V={class:"flex justify-between text-lg"},A={class:"my-4 w-full border border-brand-02 divide-y divide-brand-02 text-center"},N=t("thead",{class:"bg-brand-01 bg-opacity-50"},[t("tr",{class:"divide-x md:divide-x-0 divide-brand-02"},[t("th",null,"商品"),t("th",null,"品項"),t("th",null,"數量"),t("th",null,"原價"),t("th",null,"優惠價")])],-1),S={class:"border divide-y divide-brand-02"},E={class:"py-2"},Y={class:""},j={class:"font-semibold text-lg"},H={key:0,class:"grid grid-cols-2 gap-y-1 lg:w-1/4 text-end sm:text-lg ml-auto mt-5"},L=t("p",null,"原價",-1),R={class:"line-through text-gray-02"},U=t("p",null,"折扣碼",-1),z=t("h2",null,"總計",-1),F={key:1,class:"grid grid-cols-2 gap-y-1 lg:w-1/4 text-end sm:text-lg ml-auto mt-5"},K=t("p",null,"折扣碼",-1),q=t("p",null,"無",-1),J=t("h2",null,"總計",-1),G=t("p",null,null,-1);function Q(s,o,n,r,u,l){const f=y("DialogModal");return i(),d("div",null,[x(f,{"is-finish":!0},{"modal-btn":_(()=>[D(s.$slots,"btn-content",{},()=>[h("按鈕")])]),"modal-header":_(()=>[I]),"modal-body":_(()=>[t("div",V,[t("p",null,"訂單編號: "+a(n.orderData.id),1),t("p",null,"成立時間："+a(s.$date(n.orderData.created).format("YYYY-MM-DD")),1)]),t("table",A,[N,t("tbody",S,[(i(!0),d(w,null,v(n.orderData.cart,(e,c)=>(i(),d("tr",{class:"hover:bg-gray-03 hover:bg-opacity-30 divide-x md:divide-x-0 divide-brand-02",key:e.name+c},[t("td",E,a(e.type?e.type:e.name),1),t("td",null,a(e.type?e.name:`${s.$date(e.start).format("YYYY-MM-DD HH:mm")}~${s.$date(e.end).format("HH:mm")}`),1),t("td",null,a(e.number),1),t("td",Y,a(l.toThousand(e.totalPrice)),1),t("td",j,a(l.productDiscount(e)),1)]))),128))])]),n.orderData.discount.code?(i(),d("section",H,[L,t("p",R,a(l.toThousand(n.orderData.cart.reduce((e,c)=>e+=c.totalPrice,0))),1),U,t("p",null,a(n.orderData.discount.code),1),z,t("p",null,a(l.totalDiscountPrice(n.orderData)),1)])):(i(),d("section",F,[K,q,J,t("p",null,a(l.toThousand(n.orderData.cart.reduce((e,c)=>e+=c.totalPrice,0))),1)]))]),"modal-footerBTN":_(()=>[G]),_:3})])}const W=g(P,[["render",Q]]),{VITE_BASEURL:p}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},X={data(){return{currentOrder:{},filterOrderId:"",finalOrders:[]}},computed:{...$(b,["orders"])},methods:{...M(b,["getOrdersData"]),async patchTrackingNum(s){const{value:o}=await this.$swal.fire({title:"物流查詢編號",input:"text",inputValue:"",inputPlaceholder:"請輸入物流查詢編號",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認",reverseButtons:!0,inputValidator:n=>{if(!n)return"物流編號 必填"}});o&&(await this.$http.patch(`${p}/orders/${s}`,{trackingNumber:o,finish:!0}),this.$swal.fire(`物流查詢編號為: ${o}`),this.getOrdersData())},async orderCheck(s){const{value:o}=await this.$swal.fire({title:"請選擇訂單狀態",input:"select",customClass:{input:"border-2 border-black"},inputOptions:{cancel:"取消訂單",finish:"完成訂單"},inputPlaceholder:"訂單狀態",showCancelButton:!0,cancelButtonText:"取消",confirmButtonText:"確認",reverseButtons:!0,inputValidator:n=>{if(!n)return new Promise(r=>{r("請選擇訂單狀態")})}});o==="cancel"?(await this.$http.patch(`${p}/orders/${s}`,{isCancel:!0,finish:!0}),this.$swal.fire("已取消該筆訂單"),this.getOrdersData()):o==="finish"&&this.patchTrackingNum(s)},orderTotal(s){const o=s.cart.reduce((n,r)=>(r.isDiscount&&s.discount.code?s.discount.type==="money"?n+=r.totalPrice-s.discount.scale:n+=Math.round(r.totalPrice*s.discount.scale):n+=r.totalPrice,n),0);return m(o)},matchOrderId(){this.finalOrders.length=0,this.orders.forEach(s=>{s.id.toString().match(this.filterOrderId)&&this.finalOrders.push(s)})}},mounted(){this.getOrdersData()},components:{PostOrdersModal:W}},Z=t("label",{for:"orderSearch",class:"mt-3"},"訂單查詢",-1),tt={class:"relative"},et=t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"},null,-1),st=[et],nt={class:"grid md:grid-cols-3 grid-cols-1 gap-3 mt-5"},ot={class:"flex justify-between items-end"},at=["onClick"],rt={class:"border-t-2 border-line pt-3 mt-1 grid gap-1",style:{"word-break":"break-all"}},lt={class:"text-gray-01"},it={class:"text-gray-01"},dt={class:"text-gray-01"},ct={class:"text-gray-01"},ut={class:"text-gray-01"},ht={class:"mt-5 font-sans flex justify-between items-center"},mt={class:"text-gray-01"},_t=["onClick"],ft=t("path",{d:"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"},null,-1),bt=t("path",{d:"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"},null,-1),pt=[ft,bt],gt=["disabled"],yt=["onClick","disabled"];function xt(s,o,n,r,u,l){const f=y("PostOrdersModal");return i(),d("div",null,[Z,t("div",tt,[O(t("input",{type:"text",name:"orderSearch",id:"orderSearch",placeholder:"請輸入訂單編號...","aria-label":"訂單編號搜尋",class:"w-full p-2 pr-10 shadow-md","onUpdate:modelValue":o[0]||(o[0]=e=>u.filterOrderId=e),onKeyup:o[1]||(o[1]=B((...e)=>l.matchOrderId&&l.matchOrderId(...e),["enter"]))},null,544),[[T,u.filterOrderId]]),(i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 absolute right-3 top-2 cursor-pointer hover:top-1",onClick:o[2]||(o[2]=(...e)=>l.matchOrderId&&l.matchOrderId(...e))},st))]),t("ul",nt,[(i(!0),d(w,null,v(u.finalOrders.length?u.finalOrders.sort((e,c)=>e.finish-c.finish):s.orders.sort((e,c)=>e.finish-c.finish),(e,c)=>(i(),d("li",{class:"bg-white text-xl text-brand-05 font-self p-3",key:c},[t("h2",ot,[h(" 訂單編號: "+a(e.id)+" ",1),x(f,{"order-data":u.currentOrder},{"btn-content":_(()=>[t("button",{type:"button",class:"btn-primary py-2 px-3 text-base",onClick:()=>u.currentOrder=e}," 訂單詳情 ",8,at)]),_:2},1032,["order-data"])]),t("section",rt,[t("p",null,[h(" 購買人： "),t("span",lt,a(e.buyerInfo.name),1)]),t("p",null,[h(" 手機："),t("span",it,a(e.buyerInfo.tel),1)]),t("p",null,[h(" 取貨方式："),t("span",dt,a(e.buyerInfo.method),1)]),t("p",null,[h(" 付款方式："),t("span",ct,a(e.buyerInfo.payMethods.choose),1)]),t("p",null,[h(" 金額："),t("span",ut,"$ "+a(l.orderTotal(e)),1)]),t("section",ht,[t("h3",null,[h(" 物流編號："),t("span",mt,a(e.trackingNumber),1)]),e.trackingNumber?(i(),d("svg",{key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 flex-shrink-0 cursor-pointer hover:-translate-y-1",onClick:()=>l.patchTrackingNum(e.id)},pt,8,_t)):C("",!0)])]),e.isCancel?(i(),d("button",{key:0,type:"button",class:"btn-outline w-full mt-3",disabled:e.isCancel}," 已取消 ",8,gt)):(i(),d("button",{key:1,type:"button",class:"btn-outline w-full mt-3",onClick:()=>l.orderCheck(e.id),disabled:e.finish},a(e.finish?"已結單":"結單"),9,yt))]))),128))])])}const Ct=g(X,[["render",xt]]);export{Ct as default};
