import{m as g,b as y,u as I,o as S,f as k}from"./vueLoadingStore-98d1fb2a.js";import{t as R}from"./index-07d2539f.js";import{C as Y}from"./CoursesCard-dcc04854.js";import{b6 as B,av as D,aj as a,l,j as b,s as f,T as A,m as o,F as h,at as _,aJ as c,k as C,t as x,b1 as p,a3 as H}from"./_plugin-vue_export-helper-01f09012.js";const{VITE_BASEURL:N}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},T={data(){return{score:0,hoverScore:0,calendarDate:new Date,modelConfig:{type:"number"},hasReserve:!1}},computed:{...g(I,["user"]),...g(S,["orders"]),...g(k,["courses"]),reserves(){const e=[],t=[];return this.orders.forEach(n=>{n.isCancel||n.userId===+sessionStorage.getItem("userId")&&n.cart.forEach(i=>{if(i.courseDateId){const s={dates:i.start,description:`${i.name} ${this.$date(i.start).format("HH:mm")} ~ ${this.$date(i.end).format("HH:mm")}`};e.includes(JSON.stringify(s))||(e.push(JSON.stringify(s)),t.push(s))}})}),t},attributes(){return[...this.reserves.map(e=>({dates:e.dates,dot:{color:"red"},popover:{label:e.description,visibility:"hover",hideIndicator:!1,customData:e}}))]}},methods:{...y(S,["getOrdersData"]),...y(k,["getCoursesData"]),toThousand:R,scoreAvg(e){return(Math.round(e.reduce((n,i)=>n+=i.score,0)*10/e.length)/10).toFixed(1)},isReserveDay(e){const t=this.$date(e.start).format("YYYY-MM-DD")===this.$date(this.calendarDate).format("YYYY-MM-DD");if(t)return this.hasReserve=t,t},scoreGiven(e){let t=0;return e.forEach(n=>{n.userId===+sessionStorage.getItem("userId")&&(t=n.score)}),t},patchScore(e){this.score=this.hoverScore;const t=this.courses.findIndex(s=>s.id===e),{scores:n}=this.courses[t],i={score:this.score,userId:this.user.id};n.push(i),this.$http.patch(`${N}/courses/${e}`,{scores:n}).then(s=>{this.$swal.fire({icon:"success",title:"評分成功",showConfirmButton:!1,timer:1500})})}},watch:{calendarDate(){this.hasReserve=!1}},mounted(){this.getOrdersData(),this.getCoursesData()},components:{CoursesCard:Y}},O={class:"wrap"},L=o("h1",{class:"text-3xl font-black font-self text-brand-02"},"課程預約",-1),U={class:"grid gap-3 my-5"},j=["src","alt"],F={class:"text-brand-04 text-base self-center font-sans"},G={class:"grid lg:grid-cols-2"},J={class:"text-brand-01"},z={key:0},P={class:"flex"},$=["onMouseover","onClick"],q=o("path",{"fill-rule":"evenodd",d:"M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401z","clip-rule":"evenodd"},null,-1),K=[q],Q={class:"text-end text-lg"},W={key:0,class:"text-center text-2xl py-10"};function X(e,t,n,i,s,d){const w=D("router-link"),M=D("CoursesCard"),V=D("v-date-picker");return a(),l("main",O,[(a(),b(A,{to:"title"},[f("課程預約")])),L,o("ol",U,[(a(!0),l(h,null,_(e.courses,r=>(a(),l(h,{key:r.id+r.title},[(a(!0),l(h,null,_(r.courseDates,u=>(a(),l(h,{key:`第${u.id}課`},[(a(!0),l(h,null,_(d.reserves,(v,E)=>(a(),l(h,{key:v.description+E},[u.dates===v.start&&v.description.match(r.title)&&d.isReserveDay(u)?(a(),b(M,{key:0},{image:p(()=>[o("img",{src:r.coverUrl,alt:r.title,class:"h-full w-full object-cover"},null,8,j)]),"card-header":p(()=>[f(c(r.title)+" ",1),o("span",F,c(e.$date(u.start).format("YYYY-MM-DD")),1)]),"card-body":p(()=>[o("p",null,[f(" 時間："),o("span",null,"星期"+c(["日","一","二","三","四","五","六"][e.$date(u.start).day()])+" / "+c(e.$date(u.start).format("HH:mm"))+"~"+c(e.$date(u.end).format("HH:mm")),1)]),o("h2",null,"講師："+c(r.user.name)+" 講師",1),o("div",G,[o("p",null," 評分： "+c(isNaN(d.scoreAvg(r.scores))?"尚未評分":`${d.scoreAvg(r.scores)} / 5.0`),1),o("p",J,[d.scoreGiven(r.scores)?(a(),l("span",z,"已評分: "+c(d.scoreGiven(r.scores))+" 分",1)):(a(),l(h,{key:1},[f(" 給老師打分: "+c(s.score?s.score:s.hoverScore)+" ",1),o("span",P,[(a(),l(h,null,_(5,m=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:H(["w-5 h-5 stroke-brand-02 cursor-pointer",{"fill-brand-02":m<=s.score|m<=s.hoverScore,"fill-transparent":m>s.hoverScore}]),key:m,onMouseover:()=>s.hoverScore=m,onMouseleave:t[0]||(t[0]=()=>s.hoverScore=s.score),onClick:()=>d.patchScore(r.id)},K,42,$)),64))])],64))])]),o("p",Q,"$ "+c(d.toThousand(r.price)),1)]),"card-footer":p(()=>[x(w,{to:`/course/${u.id}`,class:"btn-primary py-2 px-3"},{default:p(()=>[f("課程詳情")]),_:2},1032,["to"])]),_:2},1024)):C("",!0)],64))),128))],64))),128))],64))),128))]),s.hasReserve?C("",!0):(a(),l("p",W,c(e.$date(s.calendarDate).format("M / D"))+" 無預約課程 ",1)),x(V,{modelValue:s.calendarDate,"onUpdate:modelValue":t[1]||(t[1]=r=>s.calendarDate=r),"model-config":s.modelConfig,color:"teal",attributes:d.attributes,"is-expanded":"","trim-weeks":""},null,8,["modelValue","model-config","attributes"])])}const re=B(T,[["render",X]]);export{re as default};
