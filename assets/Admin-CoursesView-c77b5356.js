import{C as P}from"./CoursesCard-dcc04854.js";import{D as F}from"./DialogModal-29e49acd.js";import{m as k,b as x,f as M,j as V,u as N,o as Y,i as j}from"./vueLoadingStore-27fc4ac1.js";import{l as E,k as H}from"./runtime-dom.esm-bundler-21d14b8b.js";import{b6 as L,av as I,aj as n,l as a,t as y,b1 as f,m as t,au as z,aJ as u,s as g,a3 as B,k as S,b3 as w,F as p,at as _,j as O,T as R}from"./_plugin-vue_export-helper-01f09012.js";import{D as q}from"./DiscountToggle-d66b22f7.js";import{t as J}from"./index-48e7fe8b.js";import"./use-resolve-button-type-da2c6d21.js";const{VITE_BASEURL:T}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},G={props:{isNew:{typeof:Boolean,required:!0},dateId:{typeof:Number}},data(){return{newCourseTitle:"",coursesOptions:{},editorData:{},imageStyle:"雲端圖片",isImgurLogin:sessionStorage.getItem("first_token")!=="null",isFinish:!1}},computed:{...k(M,["courses","currentCourse"]),...k(V,["imgUrl"])},components:{DialogModal:F},methods:{...x(V,["postFinal","getFirstToken","clearImgUrl"]),...x(M,["getCoursesData","getCurrent"]),finishFn(){const{contents:s,price:e,title:i,total:h,courseId:o,start:d,startHour:b,startMinute:D,endHour:r,endMinute:m}=this.editorData,C=new Date(this.$date(d).format("YYYY,MM,DD")).getTime(),c=b*60*60*1e3+D*60*1e3,l=r*60*60*1e3+m*60*1e3;if(this.imageStyle==="本地圖片"&&(this.editorData.coverUrl=this.imgUrl),this.imageStyle==="本地圖片"&&!this.imgUrl){this.$swal.fire({icon:"error",title:"還未上傳本地圖片",showConfirmButton:!1,timer:1500});return}if(new Date(this.editorData.start).getTime()<Date.now()){this.$swal.fire({icon:"error",title:"開課時段錯誤",text:"不可小於今日",showConfirmButton:!1,timer:1500});return}if(i===""){this.$swal.fire({icon:"error",title:"請選擇課程",showConfirmButton:!1,timer:1500});return}if(this.editorData.coverUrl===""){this.$swal.fire({icon:"error",title:"請選擇課程封面",showConfirmButton:!1,timer:1500});return}if(this.editorData.price<=0){this.$swal.fire({icon:"error",title:"課程售價不得為 0",showConfirmButton:!1,timer:1500});return}if(this.isNew){const v={contents:s,coverUrl:this.editorData.coverUrl,price:e,title:i,scores:[],userId:+sessionStorage.getItem("userId")},$={end:new Date(C+l).getTime(),start:new Date(C+c).getTime(),total:h,userId:+sessionStorage.getItem("userId"),savedUsersId:[],isDiscount:!1,created:new Date().getTime()};o?this.$http.patch(`${T}/courses/${o}`,v).then(U=>this.$http.post(`${T}/courseDates`,{...$,courseId:U.data.id}).then(He=>{this.$swal.fire({icon:"success",title:"課程新增成功",showConfirmButton:!1,timer:1500}),this.getCoursesData()})):this.$http.post(`${T}/courses`,v).then(U=>this.$http.post(`${T}/courseDates`,{...$,courseId:U.data.id}).then(()=>{this.$swal.fire({icon:"success",title:"課程新增成功",showConfirmButton:!1,timer:1500}),this.getCoursesData()}))}else{const{id:v}=this.editorData,$={contents:s,coverUrl:this.editorData.coverUrl,price:e,title:i},U={end:new Date(C+l).getTime(),start:new Date(C+c).getTime(),total:h,courseId:o};this.$http.patch(`${T}/courseDates/${v}`,U).then(()=>this.$http.patch(`${T}/courses/${o}`,$)).then(()=>{this.$swal.fire({icon:"success",title:"課程修改成功",showConfirmButton:!1,timer:1500}),this.getCoursesData()})}this.clearImgUrl(),this.$emit("update:date-id",0),this.isFinish=!0},addNewCourse(){this.coursesOptions[this.newCourseTitle]?this.coursesOptions[this.newCourseTitle]++:this.coursesOptions[this.newCourseTitle]=1,this.editorData.title=this.newCourseTitle,this.newCourseTitle="",this.editorData.startHour="13",this.editorData.startMinute="00",this.editorData.endHour="13",this.editorData.endMinute="00",this.editorData.start=new Date},options(){const s=this.courses.reduce((e,i)=>(e[i.title]?e[i.title]++:e[i.title]=1,e),{});this.coursesOptions=s},contentPush(s,e){this.editorData.contents[s]=e.target.value},changeTimer(){const{startHour:s,startMinute:e,endHour:i,endMinute:h}=this.editorData;s>i&&(this.editorData.endHour=this.editorData.startHour,this.editorData.endMinute=this.editorData.startMinute),s===i&&e>h&&(this.editorData.endMinute=this.editorData.startMinute)}},watch:{dateId(s){this.getCurrent(s)},currentCourse(){if(!this.currentCourse.id)this.editorData=this.currentCourse;else{const{id:s,courseId:e,userId:i,start:h,end:o,total:d,course:b}=this.currentCourse,D={id:s,courseId:e,title:b.title,coverUrl:b.coverUrl,contents:b.contents,userId:i,price:b.price,start:h,startHour:this.$date(h).format("HH"),startMinute:this.$date(h).format("mm"),end:o,endHour:this.$date(o).format("HH"),endMinute:this.$date(o).format("mm"),total:d};this.editorData=D}this.options()},"editorData.title"(){const s=this.courses.findIndex(e=>e.title===this.editorData.title);if(s!==-1){const{id:e,coverUrl:i,contents:h,price:o}=this.courses[s];this.editorData.courseId=e,this.editorData.coverUrl=i,this.editorData.contents=h,this.editorData.price=o}else(!this.editorData.courseId||s===-1)&&(this.editorData.courseId=0,this.editorData.coverUrl="",this.editorData.contents=[""],this.editorData.price=0,this.editorData.total=0)}}},K={class:"text-xl font-self"},Q={class:"flex flex-col-reverse lg:flex-row gap-3"},W={class:"flex flex-col gap-3 lg:w-96 lg:h-full h-[75vh] overflow-x-hidden px-3"},X={class:"font-semibold"},Z={class:"float-right text-gray-02 font-normal"},tt=["src","alt"],et=["src","alt"],st={key:2,for:"imgUrl"},ot={key:3,class:"flex flex-col gap-3"},rt={key:0,for:"updateImg",class:"btn-primary cursor-pointer relative"},it={key:1,class:"text-center text-red-500 text-xl"},nt={class:"flex-grow lg:border-l-2 flex flex-col gap-3 lg:px-3"},lt={class:"grid lg:grid-cols-2 gap-3"},at={for:"courseTitle"},ut=t("option",{value:"",selected:"",disabled:""},"請選擇課程",-1),dt=["value"],ct=t("label",{for:"addNewCourse"},"新增課程",-1),mt={class:"flex gap-3"},ht={class:"grid lg:grid-cols-2 gap-3"},ft=t("p",null,"* 時段選擇",-1),gt={class:"flex items-center"},pt=["onClick"],bt=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",class:"w-4 h-4 fill-brand-01 group-focus:fill-white"},[t("path",{d:"M1 4c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4zm2 2v12h14V6H3zm2-6h2v2H5V0zm8 0h2v2h-2V0zM5 9h2v2H5V9zm0 4h2v2H5v-2zm4-4h2v2H9V9zm0 4h2v2H9v-2zm4-4h2v2h-2V9zm0 4h2v2h-2v-2z"})],-1),Dt=[bt],yt=["value"],_t={class:"bg-gray-03 bg-opacity-20 flex flex-col p-2 gap-2"},vt={class:"flex gap-3 items-center"},Ct=t("span",{class:"flex-shrink-0"},"開始:",-1),wt={for:"startHour",class:"flex flex-grow"},xt=["value"],It={for:"startMinute",class:"flex flex-grow"},kt=["value"],Tt={class:"flex gap-3 items-center"},Mt=t("span",{class:"flex-shrink-0"},"結束:",-1),Ut={for:"endHour",class:"flex flex-grow"},Ht=["value"],St={for:"endMinute",class:"flex flex-grow"},$t=["value"],Et={class:"grid lg:grid-cols-2 gap-3"},Vt={for:"coursePrice",class:"grid"},Bt={for:"courseTotal",class:"grid"},Lt={class:"mb-3"},Nt={class:"grid gap-5"},Yt=["for"],jt=["name","id","value","onChange"];function Ot(s,e,i,h,o,d){const b=I("v-date-picker"),D=I("DialogModal");return n(),a("div",null,[y(D,{"finish-fn":d.finishFn,"is-finish":o.isFinish},{"modal-btn":f(()=>[t("div",{onClick:e[0]||(e[0]=()=>o.isFinish=!1)},[z(s.$slots,"btn-content",{},()=>[g("按鈕")])])]),"modal-header":f(()=>[t("h3",K,u(s.currentCourse.course?s.currentCourse.course.title:"新增文章"),1)]),"modal-body":f(()=>[t("div",Q,[t("div",W,[t("div",X,[g(" * 封面 "),t("div",Z,[t("button",{type:"button",class:B(["mr-2 hover:underline hover:text-gray-01",{"underline text-gray-01":o.imageStyle==="本地圖片"}]),onClick:e[1]||(e[1]=()=>{o.imageStyle="本地圖片"})}," 本地圖片 ",2),t("button",{type:"button",class:B(["hover:underline hover:text-gray-01",{"underline text-gray-01":o.imageStyle==="雲端圖片"}]),onClick:e[2]||(e[2]=()=>o.imageStyle="雲端圖片")}," 雲端圖片 ",2)])]),o.imageStyle==="本地圖片"&&s.imgUrl?(n(),a("img",{key:0,src:s.imgUrl,alt:o.editorData.title,class:"w-full object-cover"},null,8,tt)):o.imageStyle==="雲端圖片"?(n(),a("img",{key:1,src:o.editorData.coverUrl,alt:o.editorData.title,class:"w-full object-cover"},null,8,et)):S("",!0),o.imageStyle==="雲端圖片"?(n(),a("label",st,[g("網址"),w(t("input",{type:"text",name:"imgUrl",id:"imgUrl","onUpdate:modelValue":e[3]||(e[3]=r=>o.editorData.coverUrl=r),class:"border border-gray-01 p-2 w-full",placeholder:"請輸入圖片網址...","aria-label":"雲端圖片輸入框"},null,512),[[E,o.editorData.coverUrl,void 0,{trim:!0}]])])):(n(),a("div",ot,[o.isImgurLogin?(n(),a("label",rt,[g("上傳圖片 "),t("input",{type:"file",name:"updateImg",accept:".png",id:"updateImg",class:"absolute opacity-0",onChange:e[4]||(e[4]=r=>s.postFinal(r))},null,32)])):(n(),a("p",it," 還未取得驗證 "))]))]),t("div",nt,[t("div",lt,[t("label",at,[g("* 課程 "),w(t("select",{name:"courseTitle",id:"courseTitle",class:"border border-gray-01 p-2 w-full","onUpdate:modelValue":e[5]||(e[5]=r=>o.editorData.title=r)},[ut,(n(!0),a(p,null,_(o.coursesOptions,(r,m)=>(n(),a("option",{value:m,key:m+r},u(m),9,dt))),128))],512),[[H,o.editorData.title]])]),t("div",null,[ct,t("div",mt,[w(t("input",{type:"text",name:"addNewCourse",id:"addNewCourse",class:"border border-gray-01 p-2 w-full",placeholder:"請輸入課程名稱...","onUpdate:modelValue":e[6]||(e[6]=r=>o.newCourseTitle=r)},null,512),[[E,o.newCourseTitle,void 0,{trim:!0}]]),t("button",{type:"button",class:"btn-outline p-1 px-2 flex-shrink-0",onClick:e[7]||(e[7]=()=>d.addNewCourse())}," 確認 ")])])]),t("div",ht,[t("div",null,[ft,y(b,{class:"inline-block w-full",modelValue:o.editorData.start,"onUpdate:modelValue":e[8]||(e[8]=r=>o.editorData.start=r),color:"teal"},{default:f(({inputValue:r,togglePopover:m})=>[t("div",gt,[t("button",{type:"button",class:"p-2 bg-brand-01 bg-opacity-10 border border-brand-01 hover:bg-opacity-30 rounded-l focus:bg-brand-02 focus:border-brand-02 focus:outline-none group",onClick:()=>m()},Dt,8,pt),t("input",{value:r,class:"bg-white text-gray-01 w-full py-1 px-2 appearance-none border border-brand-03 rounded-r focus:outline-none focus:border-brand-02",readonly:""},null,8,yt)])]),_:1},8,["modelValue"])]),t("div",_t,[t("div",vt,[Ct,t("label",wt,[w(t("select",{name:"startHour",id:"startHour",class:"flex-grow","onUpdate:modelValue":e[9]||(e[9]=r=>o.editorData.startHour=r),onChange:e[10]||(e[10]=()=>d.changeTimer())},[(n(),a(p,null,_(10,r=>t("option",{value:r+12,key:r},u(r+12),9,xt)),64))],544),[[H,o.editorData.startHour]]),g("時")]),t("label",It,[w(t("select",{name:"startMinute",id:"startMinute",class:"flex-grow","onUpdate:modelValue":e[11]||(e[11]=r=>o.editorData.startMinute=r),onChange:e[12]||(e[12]=()=>d.changeTimer())},[(n(),a(p,null,_(["00","15","30","45"],r=>t("option",{value:r,key:r},u(r),9,kt)),64))],544),[[H,o.editorData.startMinute]]),g("分")])]),t("div",Tt,[Mt,t("label",Ut,[w(t("select",{name:"endHour",id:"endHour",class:"flex-grow","onUpdate:modelValue":e[13]||(e[13]=r=>o.editorData.endHour=r),onChange:e[14]||(e[14]=()=>d.changeTimer())},[(n(),a(p,null,_(10,r=>t("option",{value:r+12,key:r},u(r+12),9,Ht)),64))],544),[[H,o.editorData.endHour]]),g("時")]),t("label",St,[w(t("select",{name:"endMinute",id:"endMinute",class:"flex-grow","onUpdate:modelValue":e[15]||(e[15]=r=>o.editorData.endMinute=r),onChange:e[16]||(e[16]=()=>d.changeTimer())},[(n(),a(p,null,_(["00","15","30","45"],r=>t("option",{value:r,key:r},u(r),9,$t)),64))],544),[[H,o.editorData.endMinute]]),g("分")])])])]),t("div",Et,[t("label",Vt,[g("* 價格"),w(t("input",{type:"number",name:"coursePrice",id:"coursePrice",class:"border border-gray-01 p-2 w-full",placeholder:"請輸入價格...",min:"0",onkeyup:"value=value.replace(/^(0+)|[^\\d]+/g,'')","onUpdate:modelValue":e[17]||(e[17]=r=>o.editorData.price=r)},null,512),[[E,o.editorData.price,void 0,{number:!0}]])]),t("label",Bt,[g("開課人數"),w(t("input",{type:"number",name:"courseTotal",id:"courseTotal",class:"border border-gray-01 p-2 w-full",placeholder:"請輸入人數...",min:"0",onkeyup:"value=value.replace(/^(0+)|[^\\d]+/g,'')","onUpdate:modelValue":e[18]||(e[18]=r=>o.editorData.total=r)},null,512),[[E,o.editorData.total,void 0,{number:!0}]])])]),t("div",null,[t("p",Lt,[g(" * 課程簡介 "),o.editorData.contents&&o.editorData.contents[o.editorData.contents.length-1]?(n(),a("button",{key:0,type:"button",class:"text-brand-01 font-bold text-3xl float-right opacity-60 hover:opacity-100",onClick:e[19]||(e[19]=()=>o.editorData.contents.push(""))}," + ")):(n(),a("button",{key:1,type:"button",class:"text-brand-01 font-bold text-3xl float-right opacity-60 hover:opacity-100",onClick:e[20]||(e[20]=()=>o.editorData.contents.pop())}," - "))]),t("ul",Nt,[(n(!0),a(p,null,_(o.editorData.contents,(r,m)=>(n(),a("li",{key:r+m},[t("label",{for:`第${m}段`},u(m+1)+". ",9,Yt),t("input",{type:"text",name:`第${m}段`,id:`第${m}段`,class:"border-b border-gray-01 w-[95%]",placeholder:"例:認識主流茶葉的特性與風味 / 學習基本茶桌禮儀 ...",value:o.editorData.contents[m],onChange:C=>d.contentPush(m,C)},null,40,jt)]))),128))])])])])]),"modal-footer":f(()=>[]),_:3},8,["finish-fn","is-finish"])])}const At=L(G,[["render",Ot]]),Ft={props:{orders:{type:Object}},data(){return{range:{start:new Date,end:new Date},masks:{input:"YYYY-MM-DD h:mm A"}}},computed:{...k(M,["currentCourse"]),reserveNumber(){let s=0;return this.orders.forEach(e=>{e.cart.forEach(i=>{i.courseDateId&&i.courseDateId===this.currentCourse.id&&(s+=i.number)})}),s},reserveList(){var e;const s=[];return this.orders.forEach(i=>{i.cart.forEach(h=>{if(h.courseDateId&&h.courseDateId===this.currentCourse.id){const o={userId:i.userId,name:i.buyerInfo.name,tel:i.buyerInfo.tel,method:i.buyerInfo.payMethods.choose,number:h.number,score:0};s.push(o)}})}),(e=this.currentCourse.course)==null||e.scores.forEach(i=>{const h=s.findIndex(o=>o.userId===i.userId);h!==-1&&(s[h].score=i.score)}),s}},methods:{...x(M,["getCurrent"])},components:{DialogModal:F}},zt={class:"text-xl font-self"},Pt={class:"grid lg:grid-cols-3 gap-3"},Rt=["src","alt"],qt={class:"lg:col-span-2 lg:text-2xl flex flex-col gap-5"},Jt={class:"grid lg:grid-cols-2 gap-y-3"},Gt={class:"text-gray-02"},Kt=t("p",{class:"my-4 text-xl"},"學員名單",-1),Qt={class:"w-full table-auto text-center divide-y-2 border-2"},Wt=t("thead",{class:"bg-brand-03 bg-opacity-20"},[t("tr",null,[t("th",{class:"py-2"},"姓名"),t("th",null,"手機號碼"),t("th",null,"付款方式"),t("th",null,"人數"),t("th",null,"評分")])],-1),Xt={class:"divide-y-2"},Zt={class:"truncate py-2 max-w-[40px]"},te=t("span",null,null,-1);function ee(s,e,i,h,o,d){const b=I("DialogModal");return n(),a("div",null,[y(b,{"is-finish":!0},{"modal-btn":f(()=>[z(s.$slots,"btn-content",{},()=>[g("按鈕")])]),"modal-header":f(()=>{var D;return[t("h3",zt,u((D=s.currentCourse.course)==null?void 0:D.title),1)]}),"modal-body":f(()=>{var D,r;return[t("div",Pt,[t("img",{src:(D=s.currentCourse.course)==null?void 0:D.coverUrl,alt:(r=s.currentCourse.course)==null?void 0:r.title,class:"w-full h-64 object-cover"},null,8,Rt),t("div",qt,[t("p",null," 時段："+u(s.$date(s.currentCourse.start).format("YYYY-MM-DD"))+" ("+u(["日","一","二","三","四","五","六"][s.$date(s.currentCourse.start).day()])+") / "+u(s.$date(s.currentCourse.start).format("HH:mm"))+"~"+u(s.$date(s.currentCourse.end).format("HH:mm")),1),t("p",null,"開放人數："+u(s.currentCourse.total)+"人",1),t("p",Jt,[g(" 已預約："+u(d.reserveNumber)+"人",1),t("span",Gt,"剩餘："+u(s.currentCourse.total-d.reserveNumber)+"人",1)])])]),Kt,t("table",Qt,[Wt,t("tbody",Xt,[(n(!0),a(p,null,_(d.reserveList,m=>(n(),a("tr",{key:m.userId},[t("td",Zt,u(m.name),1),t("td",null,u(m.tel),1),t("td",null,u(m.method),1),t("td",null,u(m.number),1),t("td",{class:B({"text-red-500":!m.score})},u(m.score?m.score:"尚未評分"),3)]))),128))])])]}),"modal-footerBTN":f(()=>[te]),_:3})])}const se=L(Ft,[["render",ee]]),{VITE_BASEURL:A}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},oe={data(){return{isImgurLogin:sessionStorage.getItem("imgurId")&&sessionStorage.getItem("imgurSecret"),isImgurToken:sessionStorage.getItem("first_token")!=="null",dateId:0}},computed:{...k(M,["courses","dates"]),...k(N,["user","isLogin"]),...k(Y,["orders"]),...k(j,["discountData"]),isAllDiscount(){let s=0,e=0;return this.courses.forEach(i=>{i.courseDates.forEach(h=>{e++,h.isDiscount&&s++})}),s===e},myCourses(){const s=[];return this.courses.forEach(e=>{e.userId===+sessionStorage.getItem("userId")&&s.push(e)}),s}},methods:{toThousand:J,...x(V,["getFirstToken"]),...x(M,["getCoursesData","getCurrent","getDates"]),...x(N,["getUserData","checkLogin"]),...x(Y,["getOrdersData"]),...x(j,["getDiscountData"]),score(s){const e=s.reduce((h,o)=>h+=o.score,0),i=Math.round(e/s.length*10)/10;return isNaN(i)?0:i.toFixed(1)},allDiscount(){this.courses.forEach(s=>{s.courseDates.forEach(e=>{if(!e.isDiscount){if((this.discountData.type==="money"?s.price-this.discountData.scale:Math.round(s.price*this.discountData.scale))<=0){this.$swal.fire({icon:"error",title:"內含不可折扣商品,無法全部套用",showConfirmButton:!1,timer:1500,allowOutsideClick:!1});return}this.$http.patch(`${A}/courseDates/${e.id}`,{isDiscount:!0}).then(()=>{e.isDiscount=!0})}})})},async deleteCurrent(s){const{isConfirmed:e}=await this.$swal.fire({title:"是否刪除該課程",showCancelButton:!0,reverseButtons:!0});if(e){await this.$http.delete(`${A}/courseDates/${s}`);const{isDismissed:i}=await this.$swal.fire({icon:"success",title:"刪除課程成功",showConfirmButton:!1,allowOutsideClick:!1,timer:1500});i&&this.getCoursesData()}},async imgurLogin(){const{value:s}=await this.$swal.fire({title:"登入 imgur 帳號取得驗證",html:`<label for="imgurId">imgurId</label>
                  <input
                    name="imgurId"
                    id="imgurId"
                    type="text"
                    class="border border-gray-01 p-2 w-full"
                    placeholder="請輸入 imgur 註冊的 Client ID"
                  /> <form><label for="imgurSecret">imgurSecret</label>
                  <input
                    name="imgurSecret"
                    id="imgurSecret"
                    type="password"
                    class="border border-gray-01 p-2 w-full"
                    autocomplete="on"
                    v-model.trim="imgur.secret"
                    placeholder="請輸入 imgur 註冊的 Client Secret"
                  /></form><span class="text-sm text-red-500">
                  redirect 需設置成 http://127.0.0.1:5173/#/admin
                </span>`,focusConfirm:!1,confirmButtonText:"登入",preConfirm:()=>[document.getElementById("imgurId").value,document.getElementById("imgurSecret").value]});if(s&&s[0]&&s[1]){sessionStorage.setItem("imgurId",s[0]),sessionStorage.setItem("imgurSecret",s[1]);const i=`https://api.imgur.com/oauth2/authorize?response_type=code&client_id=${s[0]}`;location.href=i}}},mounted(){this.checkLogin(),this.getCoursesData(),this.getDates(),this.getOrdersData(),this.getDiscountData()},components:{CoursesCard:P,PostCourseModal:At,OrderCourseModal:se,DiscountToggle:q}},re={class:"admin-wrap"},ie=t("h1",{class:"text-3xl font-black font-self text-brand-02"},"課程列表",-1),ne={class:"flex flex-col lg:flex-row lg:justify-end lg:gap-5 gap-2 my-5"},le={key:2,class:"flex items-center text-sm text-gray-02"},ae=["disabled"],ue={key:0,class:"grid gap-5"},de={key:0,class:"relative"},ce={key:0,class:"absolute top-0 bottom-0 left-0 right-0 bg-gray-03 bg-opacity-50 text-red-600 text-6xl flex items-center justify-around"},me=["src","alt"],he=t("button",{type:"button",class:"btn-outline py-2 text-base mb-1"}," 編輯 ",-1),fe={class:"text-xl text-end"},ge={class:"flex flex-grow gap-3 flex-col md:flex-row justify-between"},pe={class:"flex flex-col-reverse md:flex-row gap-3"},be=["onClick"],De=t("button",{type:"button",class:"btn-primary md:w-max w-full"}," 預約詳情 ",-1),ye={key:0,class:"relative"},_e=t("div",{class:"absolute top-0 bottom-0 left-0 right-0 bg-gray-03 bg-opacity-50 text-red-600 text-6xl flex items-center justify-around"}," 已結束 ",-1),ve=["src","alt"],Ce=t("button",{type:"button",class:"btn-outline py-2 text-base mb-1"}," 編輯 ",-1),we={class:"text-xl text-end"},xe={class:"flex flex-grow gap-3 flex-col md:flex-row justify-between"},Ie={class:"flex flex-col-reverse md:flex-row gap-3"},ke=["onClick"],Te=t("button",{type:"button",class:"btn-primary md:w-max w-full"}," 預約詳情 ",-1),Me={key:1,class:"flex items-center justify-around text-3xl h-[35vh]"};function Ue(s,e,i,h,o,d){const b=I("PostCourseModal"),D=I("DiscountToggle"),r=I("router-link"),m=I("OrderCourseModal"),C=I("CoursesCard");return n(),a("main",re,[(n(),O(R,{to:"title"},[g("課程列表")])),ie,t("div",ne,[o.isImgurLogin?!o.isImgurToken&&o.isImgurLogin?(n(),a("button",{key:1,type:"button",class:"btn-primary",onClick:e[1]||(e[1]=(...c)=>s.getFirstToken&&s.getFirstToken(...c))}," 取得驗證 ")):(n(),a("p",le," 已取得 imgur 驗證,允許本地上傳圖片 ")):(n(),a("button",{key:0,type:"button",class:"btn-outline",onClick:e[0]||(e[0]=()=>d.imgurLogin())}," imgur 登入 ")),t("button",{type:"button",class:"btn-outline",onClick:e[2]||(e[2]=(...c)=>d.allDiscount&&d.allDiscount(...c)),disabled:d.isAllDiscount}," 全部套用 ",8,ae),y(b,{"is-new":!0},{"btn-content":f(()=>[t("button",{type:"button",class:"btn-primary w-full",onClick:e[3]||(e[3]=()=>{o.dateId=0,s.getCurrent(0,!0)})}," 開新課程 ")]),_:1})]),d.myCourses.length?(n(),a("ul",ue,[(n(!0),a(p,null,_(d.myCourses.sort((c,l)=>l.id-c.id),c=>(n(),a(p,{key:c.id+c.title},[(n(!0),a(p,null,_(c.courseDates.sort((l,v)=>v.id-l.id),l=>(n(),a(p,{key:`課程編號${l.courseId}的第${l.id}堂`},[l.end>new Date?(n(),a("li",de,[l.total<=0?(n(),a("div",ce," 未開放 ")):S("",!0),y(C,null,{image:f(()=>[t("img",{src:c.coverUrl,alt:c.title,class:"w-full h-64 object-cover"},null,8,me)]),"card-header":f(()=>[t("h1",null,u(c.title),1),y(b,{"is-new":!1,class:"z-10","date-id":o.dateId,onClick:()=>o.dateId=l.id},{"btn-content":f(()=>[he]),_:2},1032,["date-id","onClick"])]),"card-body":f(()=>[t("p",null," 時段："+u(s.$date(l.start).format("YYYY-MM-DD"))+" / "+u(s.$date(l.start).format("HH:mm"))+"~"+u(s.$date(l.end).format("HH:mm")),1),t("p",null,"開放人數："+u(l.total)+"人",1),t("p",null,"評分："+u(d.score(c.scores)),1),t("p",fe,"$ "+u(d.toThousand(c.price)),1)]),"card-footer":f(()=>[t("div",ge,[y(D,{"is-discount":l.isDiscount,"onUpdate:is-discount":v=>l.isDiscount=v,id:l.id,which:"courseDates",price:s.discountData.type==="money"?c.price-s.discountData.scale:Math.round(c.price*s.discountData.scale),class:"justify-end my-3 md:my-0 md:justify-start"},null,8,["is-discount","onUpdate:is-discount","id","price"]),t("div",pe,[t("button",{type:"button",class:"btn-outline",onClick:()=>d.deleteCurrent(l.id)}," 刪除 ",8,be),y(r,{to:`/course/${l.id}`,class:"btn-outline text-center"},{default:f(()=>[g("課程詳情")]),_:2},1032,["to"]),y(m,{orders:s.orders,onClick:()=>o.dateId=l.id},{"btn-content":f(()=>[De]),_:2},1032,["orders","onClick"])])])]),_:2},1024)])):S("",!0)],64))),128))],64))),128)),(n(!0),a(p,null,_(d.myCourses,c=>(n(),a(p,{key:c.id+c.title},[(n(!0),a(p,null,_(c.courseDates,l=>(n(),a(p,{key:`課程編號${l.courseId}的第${l.id}堂`},[l.end<=new Date?(n(),a("li",ye,[_e,l.userId===s.user.id?(n(),O(C,{key:0},{image:f(()=>[t("img",{src:c.coverUrl,alt:c.title,class:"w-full h-64 object-cover"},null,8,ve)]),"card-header":f(()=>[t("h1",null,u(c.title),1),y(b,{"is-new":!1,"date-id":o.dateId,onClick:()=>o.dateId=l.id},{"btn-content":f(()=>[Ce]),_:2},1032,["date-id","onClick"])]),"card-body":f(()=>[t("p",null," 時段："+u(s.$date(l.start).format("YYYY-MM-DD"))+" / "+u(s.$date(l.start).format("HH:mm"))+"~"+u(s.$date(l.end).format("HH:mm")),1),t("p",null,"開放人數："+u(l.total)+"人",1),t("p",null,"評分："+u(d.score(c.scores)),1),t("p",we,"$ "+u(d.toThousand(c.price)),1)]),"card-footer":f(()=>[t("div",xe,[y(D,{"is-discount":l.isDiscount,"onUpdate:is-discount":v=>l.isDiscount=v,id:l.id,which:"courseDates",price:c.price,class:"justify-end my-3 md:my-0 md:justify-start"},null,8,["is-discount","onUpdate:is-discount","id","price"]),t("div",Ie,[t("button",{type:"button",class:"btn-outline",onClick:()=>d.deleteCurrent(l.id)}," 刪除 ",8,ke),y(r,{to:`/course/${l.id}`,class:"btn-outline text-center"},{default:f(()=>[g("課程詳情")]),_:2},1032,["to"]),y(m,{orders:s.orders,onClick:()=>o.dateId=l.id},{"btn-content":f(()=>[Te]),_:2},1032,["orders","onClick"])])])]),_:2},1024)):S("",!0)])):S("",!0)],64))),128))],64))),128))])):(n(),a("p",Me," 無販售課程 "))])}const je=L(oe,[["render",Ue]]);export{je as default};
