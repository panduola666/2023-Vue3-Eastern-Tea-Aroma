import{u as M,o as _,c as Y,l as A,H as P,t as R,p as tt,N as L,b as w,D as et}from"./DialogModal-29e49acd.js";import{C as it}from"./ckeditor-066e2de3.js";import{m as B,b as E,j as O,h as k}from"./vueLoadingStore-67bf58d2.js";import{l as j,j as st}from"./runtime-dom.esm-bundler-21d14b8b.js";import{w as V,ar as D,al as N,i as S,ac as H,ah as z,aZ as lt,P as K,b6 as Q,av as b,aj as r,l as f,t as y,b1 as m,m as s,au as ot,aJ as x,s as g,a3 as I,k as at,b3 as C,j as q,F as U,at as J}from"./_plugin-vue_export-helper-01f09012.js";import{b as nt}from"./use-resolve-button-type-da2c6d21.js";var rt=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(rt||{});let X=Symbol("DisclosureContext");function T(t){let e=K(X,null);if(e===null){let c=new Error(`<${t} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(c,T),c}return e}let Z=Symbol("DisclosurePanelContext");function ct(){return K(Z,null)}let ut=V({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(t,{slots:e,attrs:c}){let u=D(t.defaultOpen?0:1),i=D(null),p=D(null),n={buttonId:D(null),panelId:D(null),disclosureState:u,panel:i,button:p,toggleDisclosure(){u.value=M(u.value,{[0]:1,[1]:0})},closeDisclosure(){u.value!==1&&(u.value=1)},close(o){n.closeDisclosure();let d=(()=>o?o instanceof HTMLElement?o:o.value instanceof HTMLElement?_(o):_(n.button):_(n.button))();d==null||d.focus()}};return N(X,n),Y(S(()=>M(u.value,{[0]:A.Open,[1]:A.Closed}))),()=>{let{defaultOpen:o,...d}=t,l={open:u.value===0,close:n.close};return P({theirProps:d,ourProps:{},slot:l,slots:e,attrs:c,name:"Disclosure"})}}}),dt=V({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-disclosure-button-${R()}`}},setup(t,{attrs:e,slots:c,expose:u}){let i=T("DisclosureButton");H(()=>{i.buttonId.value=t.id}),z(()=>{i.buttonId.value=null});let p=ct(),n=S(()=>p===null?!1:p.value===i.panelId.value),o=D(null);u({el:o,$el:o}),n.value||lt(()=>{i.button.value=o.value});let d=nt(S(()=>({as:t.as,type:e.type})),o);function l(){var a;t.disabled||(n.value?(i.toggleDisclosure(),(a=_(i.button))==null||a.focus()):i.toggleDisclosure())}function v(a){var $;if(!t.disabled)if(n.value)switch(a.key){case w.Space:case w.Enter:a.preventDefault(),a.stopPropagation(),i.toggleDisclosure(),($=_(i.button))==null||$.focus();break}else switch(a.key){case w.Space:case w.Enter:a.preventDefault(),a.stopPropagation(),i.toggleDisclosure();break}}function h(a){switch(a.key){case w.Space:a.preventDefault();break}}return()=>{let a={open:i.disclosureState.value===0},{id:$,...G}=t,W=n.value?{ref:o,type:d.value,onClick:l,onKeydown:v}:{id:$,ref:o,type:d.value,"aria-expanded":t.disabled?void 0:i.disclosureState.value===0,"aria-controls":_(i.panel)?i.panelId.value:void 0,disabled:t.disabled?!0:void 0,onClick:l,onKeydown:v,onKeyup:h};return P({ourProps:W,theirProps:G,slot:a,attrs:e,slots:c,name:"DisclosureButton"})}}}),pt=V({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-disclosure-panel-${R()}`}},setup(t,{attrs:e,slots:c,expose:u}){let i=T("DisclosurePanel");H(()=>{i.panelId.value=t.id}),z(()=>{i.panelId.value=null}),u({el:i.panel,$el:i.panel}),N(Z,i.panelId);let p=tt(),n=S(()=>p!==null?p.value===A.Open:i.disclosureState.value===0);return()=>{let o={open:i.disclosureState.value===0,close:i.close},{id:d,...l}=t,v={id:d,ref:i.panel};return P({ourProps:v,theirProps:l,slot:o,attrs:e,slots:c,features:L.RenderStrategy|L.Static,visible:n.value,name:"DisclosurePanel"})}}});const{VITE_BASEURL:F}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},ft={props:{isNew:{typeof:Boolean,required:!0},activityId:{typeof:Number}},data:()=>({imageStyle:"雲端圖片",activitiesData:{coverUrl:"",title:"",type:"活動",content:""},editor:it,editorConfig:{placeholder:"請輸入活動內容...",toolbar:["bold","italic","blockQuote","|","undo","redo"]},isImgurLogin:sessionStorage.getItem("first_token")!=="null",isFinish:!1}),computed:{...B(O,["imgUrl"]),...B(k,["activity"])},methods:{...E(O,["postFinal"]),...E(k,["getAllActivitiesData","getCurrentActivity"]),finishFn(){const{content:t,title:e}=this.activitiesData;if(this.imageStyle==="本地圖片"&&(this.activitiesData.coverUrl=this.imgUrl),this.imageStyle==="本地圖片"&&!this.imgUrl){this.$swal.fire({icon:"error",title:"還未上傳本地圖片",showConfirmButton:!1,timer:1500});return}if(!e){this.$swal.fire({icon:"error",title:"活動標題 未填寫",showConfirmButton:!1,timer:1500});return}if(!this.activitiesData.coverUrl){this.$swal.fire({icon:"error",title:"請選擇活動封面",showConfirmButton:!1,timer:1500});return}if(!t){this.$swal.fire({icon:"error",title:"活動內容 未填寫",showConfirmButton:!1,timer:1500});return}this.isNew?(this.activitiesData.created=new Date().getTime(),this.$http.post(`${F}/activities`,this.activitiesData).then(()=>{this.$swal.fire({icon:"success",title:"活動新增成功",showConfirmButton:!1,timer:1500}),this.getAllActivitiesData(),this.activitiesData=this.$options.data().activitiesData})):this.$http.patch(`${F}/activities/${this.activitiesData.id}`,this.activitiesData).then(()=>{this.$swal.fire({icon:"success",title:"編輯成功",showConfirmButton:!1,timer:1500}),this.getAllActivitiesData()}),this.isFinish=!0},cancelFn(){this.activitiesData=this.$options.data().activitiesData}},watch:{activity:{handler(){this.isNew||(this.activitiesData={...this.activity})},deep:!0},activityId(t){this.getCurrentActivity(t)}},components:{DialogModal:et}},mt={class:"text-xl font-black font-self text-brand-02"},vt={class:"flex flex-col-reverse lg:flex-row gap-3"},ht={class:"flex flex-col gap-3 lg:w-96 lg:h-full h-[75vh] overflow-x-hidden px-3 flex-shrink-0"},gt={class:"font-semibold"},bt={class:"float-right text-gray-02 font-normal"},yt=["src","alt"],Dt=["src","alt"],_t={key:2,for:"imgUrl"},wt={key:3,class:"flex flex-col gap-3"},$t={key:0,for:"updateImg",class:"btn-primary cursor-pointer relative"},kt={class:"flex-grow lg:border-l-2 flex flex-col gap-3 lg:px-3"},St={for:"title",class:"grid"},Ct=s("p",null,"* 分類",-1),At={class:"flex md:gap-5 gap-3 text-lg"},Bt=["for"],Et=["id","value"],xt={class:"flex-grow"},It=s("p",null,"* 活動內容",-1);function Ut(t,e,c,u,i,p){const n=b("router-link"),o=b("ckeditor"),d=b("DialogModal");return r(),f("div",null,[y(d,{"finish-fn":p.finishFn,"cancel-fn":p.cancelFn,"is-finish":t.isFinish},{"modal-btn":m(()=>[s("div",{onClick:e[0]||(e[0]=()=>t.isFinish=!1)},[ot(t.$slots,"btn-content",{},()=>[g("按鈕")])])]),"modal-header":m(()=>[s("h2",mt,x(c.isNew?"新增活動":t.activity.title),1)]),"modal-body":m(()=>[s("div",vt,[s("div",ht,[s("div",gt,[g(" * 封面 "),s("div",bt,[s("button",{type:"button",class:I(["mr-2 hover:underline hover:text-gray-01",{"underline text-gray-01":t.imageStyle==="本地圖片"}]),onClick:e[1]||(e[1]=()=>{t.imageStyle="本地圖片"})}," 本地圖片 ",2),s("button",{type:"button",class:I(["hover:underline hover:text-gray-01",{"underline text-gray-01":t.imageStyle==="雲端圖片"}]),onClick:e[2]||(e[2]=()=>t.imageStyle="雲端圖片")}," 雲端圖片 ",2)])]),t.imageStyle==="本地圖片"&&t.imgUrl?(r(),f("img",{key:0,src:t.imgUrl,alt:t.activitiesData.title,class:"w-full object-cover"},null,8,yt)):t.imageStyle==="雲端圖片"?(r(),f("img",{key:1,src:t.activitiesData.coverUrl,alt:t.activitiesData.title,class:"w-full object-cover"},null,8,Dt)):at("",!0),t.imageStyle==="雲端圖片"?(r(),f("label",_t,[g("網址"),C(s("input",{type:"text",name:"imgUrl",id:"imgUrl","onUpdate:modelValue":e[3]||(e[3]=l=>t.activitiesData.coverUrl=l),class:"border border-gray-01 p-2 w-full",placeholder:"請輸入圖片網址...","aria-label":"雲端圖片輸入框"},null,512),[[j,t.activitiesData.coverUrl]])])):(r(),f("div",wt,[t.isImgurLogin?(r(),f("label",$t,[g("上傳圖片 "),s("input",{type:"file",name:"updateImg",accept:".png",id:"updateImg",class:"absolute opacity-0",onChange:e[4]||(e[4]=l=>t.postFinal(l))},null,32)])):(r(),q(n,{key:1,to:"/admin",class:"btn-primary"},{default:m(()=>[g("取得驗證")]),_:1}))]))]),s("div",kt,[s("label",St,[g("* 標題 "),C(s("input",{type:"text",name:"title",id:"title",class:"border border-gray-01 p-2 w-full",placeholder:"請輸入商品名稱...","onUpdate:modelValue":e[5]||(e[5]=l=>t.activitiesData.title=l)},null,512),[[j,t.activitiesData.title]])]),s("div",null,[Ct,s("div",At,[(r(),f(U,null,J(["活動","優惠","展覽"],(l,v)=>s("label",{for:l+v,key:l+v},[C(s("input",{type:"radio",name:"type",class:"scale-110",id:l+v,value:l,"onUpdate:modelValue":e[6]||(e[6]=h=>t.activitiesData.type=h)},null,8,Et),[[st,t.activitiesData.type]]),g(x(l),1)],8,Bt)),64))])]),s("div",xt,[It,y(o,{editor:t.editor,modelValue:t.activitiesData.content,"onUpdate:modelValue":e[7]||(e[7]=l=>t.activitiesData.content=l),config:t.editorConfig},null,8,["editor","modelValue","config"])])])])]),"modal-footer":m(()=>[]),_:3},8,["finish-fn","cancel-fn","is-finish"])])}const Pt=Q(ft,[["render",Ut]]),{VITE_BASEURL:Vt}={VITE_BASEURL:"https://2023-vue3-eastern-tea-aroma.onrender.com",BASE_URL:"/2023-Vue3-Eastern-Tea-Aroma/",MODE:"production",DEV:!1,PROD:!0},Tt={data(){return{currentId:0}},computed:{...B(k,["activities"])},methods:{...E(k,["getAllActivitiesData"]),async deleteActivity(t){const{isConfirmed:e}=await this.$swal.fire({title:"是否刪除該活動",showCancelButton:!0,reverseButtons:!0});if(e){await this.$http.delete(`${Vt}/activities/${t}`);const{isDismissed:c}=await this.$swal.fire({icon:"success",title:"刪除成功",showConfirmButton:!1,allowOutsideClick:!1,timer:1500});c&&this.getAllActivitiesData()}}},mounted(){this.getAllActivitiesData()},components:{Disclosure:ut,DisclosureButton:dt,DisclosurePanel:pt,PostActivitiesModal:Pt}},Mt={class:"text-end"},Lt=s("button",{type:"button",class:"btn-primary lg:px-10 py-2 text-lg"}," 新增活動 ",-1),Ot={class:"bg-white p-3 pb-10 mt-3"},jt=s("h2",{class:"text-xl mb-3"},"活動列表",-1),Ft={class:"rounded-md grid gap-3"},Rt=["onClick"],Nt=s("path",{"fill-rule":"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.256 1.478l-.209-.035-1.005 13.07a3 3 0 01-2.991 2.77H8.084a3 3 0 01-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 01-.256-1.478A48.567 48.567 0 017.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 013.369 0c1.603.051 2.815 1.387 2.815 2.951zm-6.136-1.452a51.196 51.196 0 013.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 00-6 0v-.113c0-.794.609-1.428 1.364-1.452zm-.355 5.945a.75.75 0 10-1.5.058l.347 9a.75.75 0 101.499-.058l-.346-9zm5.48.058a.75.75 0 10-1.498-.058l-.347 9a.75.75 0 001.5.058l.345-9z","clip-rule":"evenodd"},null,-1),Ht=[Nt],zt={class:"flex-grow w-1"},Kt={class:"text-lg font-bold truncate"},Qt={key:0,src:"https://github.com/panduola666/2023-Vue3-Eastern-Tea-Aroma/blob/main/public/icon-.png?raw=true",alt:"收合"},qt={key:1,src:"https://github.com/panduola666/2023-Vue3-Eastern-Tea-Aroma/blob/main/public/icon+.png?raw=true",alt:"展開"},Jt=["innerHTML"],Xt={class:"flex justify-end gap-3"},Zt=s("button",{type:"button",class:"btn-outline py-1 px-2"}," 編輯 ",-1);function Gt(t,e,c,u,i,p){const n=b("PostActivitiesModal"),o=b("DisclosureButton"),d=b("router-link"),l=b("DisclosurePanel"),v=b("Disclosure");return r(),f(U,null,[s("div",Mt,[y(n,{"is-new":!0,onClick:e[0]||(e[0]=()=>i.currentId=0)},{"btn-content":m(()=>[Lt]),_:1})]),s("section",Ot,[jt,s("ul",Ft,[(r(!0),f(U,null,J(t.activities,h=>(r(),q(v,{as:"li",class:"flex gap-3",key:h.index},{default:m(({open:a})=>[(r(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-6 h-6 fill-red-300 hover:fill-red-600 cursor-pointer flex-shrink-0 my-2",onClick:()=>p.deleteActivity(h.id)},Ht,8,Rt)),s("div",zt,[y(o,{class:I(["py-2 flex items-center justify-between px-3 bg-opacity-30 rounded-md hover:bg-opacity-30 w-full",{"bg-brand-01 hover:bg-brand-02":a,"bg-brand-03 hover:bg-brand-01":!a}])},{default:m(()=>[s("h3",Kt,x(h.title),1),a?(r(),f("img",Qt)):(r(),f("img",qt))]),_:2},1032,["class"]),y(l,null,{default:m(()=>[s("article",{class:"m-3 max-h-36 overflow-hidden",innerHTML:h.content},null,8,Jt),s("div",Xt,[y(d,{to:`/activity/${h.id}`,type:"button",class:"btn-outline py-1 px-2"},{default:m(()=>[g(" 查看活動 ")]),_:2},1032,["to"]),y(n,{"is-new":!1,"activity-id":i.currentId,onClick:()=>i.currentId=h.id},{"btn-content":m(()=>[Zt]),_:2},1032,["activity-id","onClick"])])]),_:2},1024)])]),_:2},1024))),128))])])],64)}const le=Q(Tt,[["render",Gt]]);export{le as default};
